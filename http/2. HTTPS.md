# HTTPS
### 참고자료
* [Http와 Https 이해와 차이점 그리고 오해(?)](https://jeong-pro.tistory.com/89)
* [HTTP와 HTTPS 및 차이점](https://mangkyu.tistory.com/98)
### 개념
* SSL의 껍데기를 쓴 HTTP
* HTTP는 원래 직접 TCP와 통신했지만 HTTPS에서는 HTTP는 SSL과 통신하고 이 SSL이 TCP와 통신
* SSL을 사용한 HTTPS는 암호화와 증명서, 안전성 보호를 이용할 수 있음
* HTTPS의 암호화 원리를 간단하게 표현하면 공개키 암호화 방식. 공개키 저장소(CA. Certificate Authority)
* 대칭키와 비대칭키 암호화를 모두 사용하여 빠른 연산속도와 안전성을 모두 얻음
  * 대칭키
    * 클라이언트와 서버가 동일한 키를 사용하여 암호화/복호화를 진행
    * 키가 노출되면 매우 위험하지만 연산속도가 빠름
  * 비대칭키
    * 1개의 쌍으로 구성된 공개키와 개인키를 암호화/복호화 하는데 사용
    * 키가 노출되어도 비교적 안전하지만 연산 속도가 느림
    * 공개 키
        * 모두에게 공개 가능한 키
        * 공개 키로 암호화하면 개인키로만 복호화 할 수 있음 -> 개인키는 나만 가지고 있으므로 나만 볼 수 있음
    * 개인 키
        * 나만 가지고 알고 있어야 하는 키
        * 개인키로 암호화하면 공개키로만 복호화 할 수 있음 -> 공개 키는 모두에게 공개되어  으므로 내가 인증한 정보임을 알려 신뢰성을 보장할 수 있음


## 기존 HTTP의 문제점
### HTTP는 평문 통신이기 떄문에 도청이 가능
* 문제점
    * TCP/IP 구조는 전부 통신 경로 상에서 엿볼수 있음
    * 패킷을 수집 하는 것만으로도 도청 가능
    * 평문 통신을 하는 경우 메시지의 의미를 파악할 수 있기 때문에 암호화하여 통신 해야함
* 보완방법
    * 통신 자체를 암호화 SSL(Secure Socket Layer) or TLS(Transport Layer Security)라는 다른 프로토콜을 조합하면서 HTTP 통신 내용을 암호화 할 수 있음
    * SSL을 조합한 HTTP를 HTTPS or HTTP over SSL이라고 함
    * TLS가 가장 최근기술
### 통신 상대를 확인하지 않기 때문에 위장이 가능
* 문제점
    * 누구든지 리퀘스트 요청을 보낼 수 있음
    * 상대가 누구든지 무엇인가 리스폰스를 반환
    * 리퀘스트 보낸 곳의 웹 서버가 원래 의도한 리스폰스를 보내야하는 웹 서버인지 모름
    * 리스폰스를 반환 한 곳의 클라이언트가 원래 의도한 리퀘스트를 보낸 클라이언트 인지 확인 할 수 없음
    * 통신하고 있는 상대가 접근 허가 된 상대인지 모름
    * 의미 없는 리퀘스트도 수신(dos의 문제)
* 보완방법
    * 암호화된 방법 SSL로 상대를 확인할 수 있음. SSL은 상대를 확인하는 수단으로 증명서를 제공
    * 이 증명서는 신뢰 할 수 있는 제 3기관에 의해 발행되는 것이기 떄문에 서버나 클라이언트가 실재하는 사실을 증명
### 완전성을 증명할 수 없기 때문에 변조가 가능
* 문제점
    * 여기서의 완전성이란 정보의 정확성. ```서버 또는 클라리언트에서 수신한 내용이 송신 측에서 보낸 내용과 일치한다```라는 것을 보장할 수 없음
    * 리퀘스트나 리스폰스 사이에 누군가에 의해 변조되더라도 이 사실을 알 수 없음
    * 이러한 공격을 중간자 공격이라고 부름
* 보완방법
    * SHA-1 등의 해시 값을 확인 하는 방법과 파일의 디지털 서명을 확인하는 방법이 존재
    * SSL에는 인증이나 암호화 그리고 다이제스트 기능을 제공

## HTTPS Flow
* HTTPS는 대칭키 암호화와 비대칭키 암호화를 모두 사용
* HTTPS 연결과정에서 먼저 서버와 클라이언트 간 세션키를 교환. 여기서의 세션키는 주고 받는 데이터를 암호화하기 위한 대칭키. 데이터 교환 간의 교환에는 빠른 연산 속도가 필요하므로 세션키는 대칭키로 만들어짐
* 문제는 이 세션키를 클라이언트와 서버가 어떻게 교환하는 것 -> 이 과정에서 비대칭 키가 사용
* 즉 처음 연결을 성립하여 안전하게 세션키를 공유하는 과정에서 비대칭키 사용. 이후에는 빠른 연산 속도를 위해 대칭키 사용
### HTTPS 연결과정이 성립되는 흐름
* 클라이언트가 서버로 연결 시드
* 서버는 공개키를 브라우저에 넘겨줌
* 브라우저는 인증서의 유효성을 검사하고 세션키를 발급
* 브라우저는 세션키를 보관하며 추가적으로 서버의 공개키로 세션키를 암호화하여 서버로 전송
* 서버는 개인키로 암호화된 세션키를 복호화하여 세션키를 얻음
* 클라이언트와 서버는 동일한 세션키를 공유하므로 데이터를 전달할 때 세션키로 암호화/복호화 진행(동일한 서버로 부터 온 응답임을 확신. 보안상의 이점은 없음)

## HTTPS 사용할 때의 문제점
* 평문 통신에 비해 암호화 통신은 CPU나 메모리를 더욱 많이 사용함
* 따라서 서버 한 대당 처리 할 수 있는 리퀘스트의 수가 상대적으로 줄어들게 됨
* 하지만 최근에는 하드웨어의 발달로 HTTPS를 사용하더라도 속도의 저하를 체감하기 힘듦
* 또한 새로운 표진인 HTTP 2.0를 함께 이용한다면 HTTP보다 더 빠르게 동작 한다고함